# cKAM-Conefield_implementation
Conefield implementation of Converse KAM results on a toroidal magnetic field.

Codes implementing a conefield approach and "killends" subsidiary criterion to Converse KAM results (MacKay'18◭) to near-integrable examples of axisymmetric magnetic fields perturbed by helical two terms (Kallinikos et. al 2014◧). This approach is n alternative, yet equivalent, implementation of the method described in Kallinikos et. al 2023◉). Details can be found in (Martinez'25 △).


The Python scripts included are

1. 'cKAM_CF_2r.py':  Computes the cone field implementation of the Converse KAM theorem, as described in △, on the upper poloidal plane in symplectic coordinates using a regular grid of initial conditions. For each point in the grid, the code determines either that the point does not lie on a surface transverse to the radial vector field ξ, or provides bounds (s^\pm) for the slope of the flux surface passing through the point that are compatible (i.e., transverse) with ξ.
Input: "ini.txt"
Output: "cf_[ini_points]_[tf]_[e1]_[m1]_[n1]_[e2]_[m2]_[n2].txt"
Modules: matplotlib, sympy, numpy, scipy, joblib, time, datetime, simplejson, cf_comp* and cf_tools*.
* modules are included in the same folder.

2. 'cKAM_CF_2r_plot_simple.py' : Plots the resutls from "cKAM_CF_2r.py" in 3 figures:
            (1) Red/blue detection/no-detection; in symplect coordinates: (\sqrt(2\psi \cos(\vartheta), \sqrt(2\psi \sin(\vartheta)).
            (2) Hues to display the time of detection (in symplect coordinates)
            (3) Hues to display the time of detection; in polar coordinates: (\vartheta, \sqrt(2\psi)) 
Input: "ini.txt", "cf_[ini_points]_[tf]_[e1]_[m1]_[n1]_[e2]_[m2]_[n2].txt"


3. 'cKAM_CF_2r_plot_cones.py' : Plots the same figures in 'cKAM_CF_2r_plot_simple.py' with the adition of superimposed cones on top of the non-eliminated points.
Input: "ini.txt", "cf_[ini_points]_[tf]_[e1]_[m1]_[n1]_[e2]_[m2]_[n2].txt"

4. 'ke_branch_comp.py : Computes the "killends branches" (ker s^\pm) using Euler integration of the kernels s^\om for seed points chosen in the vicinities of the max amplitude of the islands associated to the resonances (2,1) and (3,2).
Input: "ini.txt", "cf_[ini_points]_[tf]_[e1]_[m1]_[n1]_[e2]_[m2]_[n2].txt"
Output: "ke_brch[N]_[tf].txt , N= 0,...,4. 

5. 'ke_plot_2r_full.py': Computes the enclosed area by the killends branches and plots the conefield results and superimpose the spline smoothed killends branches on the upper half plane in symplectic coordinates only.
Input: "ini.txt", "cf_[ini_points]_[tf]_[e1]_[m1]_[n1]_[e2]_[m2]_[n2].txt", "ke_brch[N]_[tf].txt 


6. 'ke_encl_area.py':  Computes the enclosed area by the killends branches and plots the area enclosed by the smoothed branches on the upper half plane in symplectic coordinates only.
Input: "ini.txt", "ke_brch[N]_[tf].txt 

7. 'cf_comp.py': Conefield computation and tensor (symbolic & numerical) subroutines/funtions

8. 'cf_tools.py': Data format manipulation, and graphic - subroutines/definitions


Codes 1, 5 and 6, consider a regular grid of initial conditions on the YZ-plane for the given magnetic field. Y and Z here correspond to the symplectic polar coordinates: (\tilde{y},\tilde{z}) = (\sqrt{2ψ/B0} cos\vartheta, \sqrt{2ψ/B0} sin\vartheta). Code 1 identifies cases where the initial condition does not correspond to a flux surface of the same class as those in the unperturbed case (which consists of concentric circles around the origin). Codes 2, 3, 5, and 6 are plotting scripts only. Code 4 computes the kernel of the killend branches (ker⁡ s^\pm) from the data generated by Code 1. Codes 5 and 6 use the grid to compute the area enclosed by the killend branches.


Notes: 
- The plot coordinates used by most of these scripts correspond to symplectic polar: (\tilde{y},\tilde{z}) = (\sqrt{2ψ/B0} cos\vartheta, \sqrt{2ψ/B0} sin\vartheta).

- The definition of the symplectic polar coordinates puts the magnetic axis to the origin for most of the plots. In the original toroidal coordinates, it corresponds to r = 0 (i.e. R=R0) or in cartesian coordinates (x,y,z=0) with x^2 + y^2 = R0^2.



References

△ D. Martínez-del-Río and R.S. MacKay. "Conefield approach to identifying regions without flux surfaces for magnetic fields". To be subminted, 2025.

◉ N. Kallinikos, R.S. MacKay and D. Martínez-del-Río. "Regions without flux surfaces of given class for magnetic fields in toroidal geometry". Plasma Phys. Control. Fusion 65 095021, 2023.

◭ R.S. MacKay. “Finding the complement of the invariant manifolds transverse to a
given foliation for a 3D flow”. Regular and Chaotic Dynamics 23(8), 2018.

◧ N. Kallinikos, H. Isliker, L. Vlahos, E. Meletlidou. “Integrable perturbed magnetic
fields in toroidal geometry: An exact analytical flux surface label for large aspect
ratio”. Physics of Plasmas 21(6), 2014.
